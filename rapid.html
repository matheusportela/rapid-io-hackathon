<html>
    <head>
        <script src="https://unpkg.com/rapid-io/dist/rapid.umd.js"></script>
        <script>
            const client = Rapid.createClient('NDA1OWE0MWo1b3AzOTh6LnJhcGlkLmlv')
            const luggages = client.collection('luggages')

            luggages
            .filter({status: 'checked-in'}) //subscribe only to luggage that is checked in
                .subscribe(luggages => {
                    console.log(luggages.length)
                    console.log(luggages)
                })



            var total_bags=luggages.lenght; //to count total number of documents (doesn't work)

            var total_cars = 30; //assume the airport has 30 cars for the simulation

            const car_cap = 10;
            
            function make_bag_cin(num){ //works fine
                //create checked in bags 
                for(var i = 0; i<  num; i++){
                luggages
                .document('suitcase' + i)
                .mutate({
                    type: 'fragile',    //we dont use type parameter yet
                    status: 'checked-in',
                    flight_number: 1
                })
                .then(
                    () => console.log('success'),
                    err => {
                        if (err) {
                            switch (err.type) {
                                case 'timeout':
                                case 'permission-denied':
                                    console.log(err.type)
                                    break
                            }
                        }
                    }
                )
                }
            }

            make_bag_cin(20); //make 20 bags




            function make_bag_cout(num){ //works fine
                //create checked out bags to make sure collection doesn't pat attention to them

                for(var i = 0; i<  num; i++){
                luggages
                .document('suitcase' + (i+10))
                .mutate({
                    type: 'fragile',
                    status: 'checked-out',
                    flight_number: 1
                })
                .then(
                    () => console.log('success'),
                    err => {
                        if (err) {
                            switch (err.type) {
                                case 'timeout':
                                case 'permission-denied':
                                    console.log(err.type)
                                    break
                            }
                        }
                    }
                )
                }
            }

            make_bag_cout(10); //make ten bags

            function car(){

                total_cars--; //use up a car
                for(var i= 0; i< car_cap; i++){
                    luggages
                    .document('suitcase' + i)
                    .mutate({
                        status: 'checked-out',
                        flight_number: '54321'
                    })
                    .then(
                        err => {
                        if (err) {
                            switch (err.type) {
                                case 'timeout':
                                case 'permission-denied':
                                    console.log(err.type)
                                    break
                            }
                        }
                    })
                }

              
            }

            // function plane_depart(){
            //     //deletes all luggages with plane's flight number
            // }

            // function load_plane(num_cars){
            //     var payload = num_cars * car_cap;

            //     //need to reassign flight number to current planes's flight number (can generate new number)
            //     total_cars = total_cars + num_cars; //returns cars back to airport

            //     if(payload >= plane_cap){    //corner case: when payload excees max capacity
            //         plane_depart();
            //     }
            // }

              //car();

              if(luggages.length > 15){ //need bounded waiting and priority queue
                car();
              }


                // var x = [];
                // console.log(x.length);
                // console.log(x.length);
                // console.log(x.length==x.length);
                // x =[1,2,3];
                // console.log(x.length);
                // console.log(x.length);
                // console.log(x.length==x.length);

                // if(total_bags > 3){
                //     console.log('fail');
                // }
                /*
                .delete instead of .mutate
                */

  

        </script>
    </head>
    <body>
    </body>
</html>
